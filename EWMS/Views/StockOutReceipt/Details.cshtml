@model EWMS.ViewModels.StockOutReceiptViewModel
@{
    ViewData["Title"] = "Stock Out Receipt Details";
}

@section Styles {
    <link rel="stylesheet" href="~/css/stockoutreceipt.css" asp-append-version="true" />
}

<div class="page-header">
    <div>
        <h1>Stock Out Receipt Details</h1>
        <p>Receipt ID: <strong>@Model.ReceiptNumber</strong></p>
    </div>
    <div>
        <a href="@Url.Action("Index")" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back
        </a>
        <button class="btn btn-success" onclick="window.print()">
            <i class="bi bi-printer"></i> Print
        </button>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="detail-section">
            <h4>Stock Out Receipt Information</h4>
            <div class="detail-grid">
                <div class="detail-item">
                    <div class="detail-label">Receipt ID:</div>
                    <div class="detail-value"><strong>@Model.ReceiptNumber</strong></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Order ID:</div>
                    <div class="detail-value">
                        @if (Model.OrderNumber != null)
                        {
                            <a href="@Url.Action("Details", "SalesOrder", new { id = Model.SalesOrderId })">
                                <strong>@Model.OrderNumber</strong>
                            </a>
                        }
                        else
                        {
                            <span>N/A</span>
                        }
                    </div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Issue Date:</div>
                    <div class="detail-value">@(Model.IssuedDate?.ToString("dd/MM/yyyy HH:mm") ?? "N/A")</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Warehouse:</div>
                    <div class="detail-value">@Model.WarehouseName</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Issued By:</div>
                    <div class="detail-value">@Model.IssuedByName</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Reason:</div>
                    <div class="detail-value">@Model.Reason</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Status:</div>
                    <div class="detail-value">
                        @if (!string.IsNullOrEmpty(Model.Status))
                        {
                            <span class="badge 
                                @(Model.Status == "Pending" ? "bg-warning text-dark" : 
                                  Model.Status == "Completed" ? "bg-success" : 
                                  Model.Status == "Cancelled" ? "bg-danger" : "bg-secondary")">
                                @Model.Status
                            </span>
                        }
                        else
                        {
                            <span class="text-muted">N/A</span>
                        }
                    </div>
                </div>
                @if (!string.IsNullOrEmpty(Model.Notes))
                {
                    <div class="detail-item" style="grid-column: 1 / -1;">
                        <div class="detail-label">Notes:</div>
                        <div class="detail-value" style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #3498db;">
                            @Model.Notes
                        </div>
                    </div>
                }
            </div>
        </div>

        <div class="detail-section">
            <h4>Customer Information</h4>
            <div class="detail-grid">
                <div class="detail-item">
                    <div class="detail-label">Customer Name:</div>
                    <div class="detail-value">@Model.CustomerName</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Phone Number:</div>
                    <div class="detail-value">@(Model.CustomerPhone ?? "N/A")</div>
                </div>
                <div class="detail-item" style="grid-column: 1 / -1;">
                    <div class="detail-label">Address:</div>
                    <div class="detail-value">@(Model.CustomerAddress ?? "N/A")</div>
                </div>
            </div>
        </div>

        <div class="detail-section">
            <h4>Stock Out Details</h4>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Location</th>
                            <th class="text-end">Quantity</th>
                            <th class="text-end">Unit Price</th>
                            <th class="text-end">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var detail in Model.Details)
                        {
                            <tr>
                                <td>@detail.ProductName</td>
                                <td>
                                    <span class="badge bg-info">@detail.LocationCode</span>
                                    @if (!string.IsNullOrEmpty(detail.LocationName))
                                    {
                                        <small class="text-muted">(@detail.LocationName)</small>
                                    }
                                </td>
                                <td class="text-end">@detail.Quantity @detail.Unit</td>
                                <td class="text-end">@detail.UnitPrice.ToString("N0") đ</td>
                                <td class="text-end">@detail.TotalPrice.ToString("N0") đ</td>
                            </tr>
                        }
                        <tr class="table-active fw-bold">
                            <td colspan="4" class="text-end">Grand Total:</td>
                            <td class="text-end text-primary fs-5">@((Model.TotalAmount ?? 0).ToString("N0")) đ</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="detail-section">
            <h4>Additional Information</h4>
            <div class="detail-grid">
                <div class="detail-item">
                    <div class="detail-label">Created Date:</div>
                    <div class="detail-value">@(Model.CreatedAt?.ToString("dd/MM/yyyy HH:mm:ss") ?? "N/A")</div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        window.addEventListener('beforeprint', () => {
            document.querySelector('.btn-secondary')?.style.setProperty('display', 'none', 'important');
            document.querySelector('.btn-success')?.style.setProperty('display', 'none', 'important');
        });

        window.addEventListener('afterprint', () => {
            document.querySelector('.btn-secondary')?.style.removeProperty('display');
            document.querySelector('.btn-success')?.style.removeProperty('display');
        });
    </script>
}
